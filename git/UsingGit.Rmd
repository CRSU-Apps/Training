---
title: "Introduction to version control with Git for researchers"
author: "Janion Nevill & Clareece Nevill"
date: "10th April 2024"
output: 
  bookdown::html_document2:
    number_sections: true
    toc: true
    toc_float: true
---

<!---
# Style Notes:
- Buttons, pages, menu items, etc. are referred to as "*<NAME>*".
- All items found in the glossary are linked, every time they are used.
--->

```{r, echo = FALSE, message = FALSE, include = FALSE}
# To get the glossary working correctly, the {glossary} package must be installed from GitHub
# remotes::install_github("https://github.com/debruine/glossary")
# This is because required features are not available in version 1.0.0, and no subsequent releases have been made

library(glossary)
glossary::glossary_path("gitGlossary.yml")
glossary::glossary_popup("hover")
```

<!---
# TODO:
- [X] Update alt-text for images
- [X] Move .gitignore section earlier
- [X] Add "Other Resources" section (with emails)
- [X] Add windows credentials section
- [X] Fix glossary
- [X] Make references to *Git*, *GitHub* and *Sourcetree* consistent.
- [X] Revert
- [X] Branches
- [X] Make section tags consistent
- [X] Make references to buttons consistent
- [ ] Make references to sections consistent
--->

# Introduction

## What is 'Version Control'?

Have you ever found yourself naming files like the image below? If so, version control can help you.

```{r, label = "bad-vc", dpi=45, fig.align = "center", echo = FALSE, fig.cap ="How people commonly name their files..."}
knitr::include_graphics("images/BadVersionControl.png")
```

Version control is a system which records all changes made to documents stored in a `r glossary("repository")`. These documents are usually `r glossary("source code")` files but can be any format (e.g. word documents). This system makes a new entry in the `r glossary("history", display = "version history")` every time changes are `r glossary("commit", display = "committed")`; each record contains the list of changes made, a timestamp of when they were made and the name of the person who made them.

## Why Should I Bother with Version Control?

Having a record of previous versions allows anyone to look through old versions of their projects without needing to keep a `r glossary("local")` copy of every version they have made. This is especially useful when a new version is found to have new bugs since the last version. The individual changes can be examined to find the source of the problem without the need to look through the entire `r glossary("codebase")`. In particular with *`r glossary("GitHub")`*, when you go to view a `r glossary("commit")`, it will highlight the changes between versions for you. Furthermore, if needed, *`r glossary("Git")`* can allow you to `r glossary("revert")` back to a previous version (although how to do this is not covered in this document).

It also makes it easy to share code around if there is a public `r glossary("repository")` containing the code.

## What is *Git* and *GitHub*?

You may have previously heard about both *`r glossary("Git")`* and *`r glossary("GitHub")`*, but the difference between them is rarely explained. *`r glossary("Git")`* is an application that implements version control for any type of file, it is *`r glossary("Git")`* that actually does the work. *`r glossary("Git")`* can be used to track changes in a project on your `r glossary("local", display = "local computer")`, without publishing it to the web, but this tutorial will focus on using *`r glossary("GitHub")`* as a `r glossary("remote")` `r glossary("repository")`.

*`r glossary("GitHub")`* is simply a web hosting service for projects; this is where projects can be stored, tracked, and published. A free account can create 3 private repositories which will be visible only to the user who created them and those who are explicitly given permission.

To put a metaphor on it, *`r glossary("GitHub")`* could be thought of as a warehouse which stores products (our files); *`r glossary("Git")`* would be the forklift used to move the products in and out of the warehouse.

## What is *Sourcetree*?

*`r glossary("Git")`* is often used as a `r glossary("command line")` tool, but this tutorial will use a graphical application to interact with it. *`r glossary("Sourcetree")`* simplifies the use of *`r glossary("Git")`* by allowing users to use a graphical interface, rather than needing to remember commands to be typed into the `r glossary("command line")`. This also makes it much easier to see changes and to perform more advanced operations.

Some applications have their own integration for *`r glossary("Git")`*, but many do not. *`r glossary("Sourcetree")`* is a stand-alone application which allows us to version control our files, while using whichever application we prefer to create and modify those files.

# Download and Install

This section demonstrates how to set up *`r glossary("Git")`* and *`r glossary("Sourcetree")`* for a Windows computer, but the steps will be very similar for Macs.

## Download and Install *Git*

On university computers, *`r glossary("Git")`* must be installed via the software centre.

```{r, label = "software-git", dpi=96, fig.align = "center", echo = FALSE, fig.cap ="Installing Git using Software Centre"}
knitr::include_graphics("images/Software_Git.png")
```

## Download and Install *Sourcetree*

*`r glossary("Sourcetree")`* can be installed by downloading it from the [Sourcetree website](https://www.sourcetreeapp.com). Make sure to click the "*Download for Windows/Mac*" button, rather than the "*Download for free*" button.

### Registration

If you have an existing *`r glossary("BitBucket")`* account, then this can be used to register the software, otherwise registration can be skipped.

```{r, label = "resgistration", dpi=96, fig.align = "center", echo = FALSE, fig.cap ="Registration step when installing Sourcetree"}
knitr::include_graphics("images/sourcetree/sourcetree_registration.png")
```

### Install Tools

For this tutorial, we are using *`r glossary("Git")`*, so *`r glossary("Mercurial")`* can be unchecked.

```{r, label = "install-tools", dpi=96, fig.align = "center", echo = FALSE, fig.cap ="Tool installation step when installing Sourcetree"}
knitr::include_graphics("images/sourcetree/sourcetree_install_tools.png")
```

### Preferences

Finally, *`r glossary("Sourcetree")`* requires a user name and email address. this is used to sign the `r glossary("commit", display = "commits")` in *`r glossary("Git")`*. It is recommended to use your full name without spaces, and your university email address.

You may also be asked about setting up *SSH keys*, simple select the "No" button and move on.

```{r, label = "preferences", dpi=96, fig.align = "center", echo = FALSE, fig.cap ="Preferences step when installing Sourcetree"}
knitr::include_graphics("images/sourcetree/sourcetree_preferences.png")
```

### Home Page

*`r glossary("Sourcetree")`* will open the home page with no repositories currently listed.

```{r, label = "home", dpi=96, fig.align = "center", echo = FALSE, fig.cap ="Sourcetree home page"}
knitr::include_graphics("images/sourcetree/sourcetree_fresh.png")
```

# Creating and Cloning a *GitHub* Repository

This section will focus on starting a new project. If you have an existing `r glossary("repository")` that you would like to work on, then skip to \@ref(clone).

## Create a repository {#new-repo}

First, you need to create a new `r glossary("repository")` within your *`r glossary("GitHub")`* account. Go to <http://github.com> and create a new `r glossary("repository")` using the green "*New*" button in the top-left corner of the home page (figure \@ref(fig:new-repo-button)).

```{r, label = "new-repo-button", dpi=75, fig.align = "center", echo = FALSE, fig.cap ="Green new repository button on GitHub"}
knitr::include_graphics("images/github/github_home.png")
```

Next, fill in the necessary details as in figure \@ref(fig:create-new-repo). You can choose whether to have your `r glossary("repository")` as *public* or *private* depending on your needs; generally a public `r glossary("repository")` is preferable unless your code contains sensitive information or intellectual property which is to be protected.

Helpfully, *`r glossary("GitHub")`* provides templates for a `.gitignore` file, which will prevent you from `r glossary("commit", display = "committing")` files which are not required to share the project. Select the default for your project's language from the dropdown menu. This will be covered in more detail in \@ref(git-ignore)

```{r, label = "create-new-repo", dpi = 50, fig.align = "center", echo = FALSE, fig.cap = "New repository form on GitHub"}
knitr::include_graphics("images/github/github_new.png")
```

Once you have completed the configuration, click "*Create repository*". You will be taken to the home of the project which will contain 2 files: `.gitignore` and `README.md`. This "*README*" file is a `r glossary("markdown")` file which is used to describe the project. By default, it will contain the name and description entered on the previous page.

```{r, label = "new-repo", dpi = 50, fig.align = "center", echo = FALSE, fig.cap = "Newly created repository on GitHub"}
knitr::include_graphics("images/github/github_project.png")
```

## Clone the Repository {#clone}

To make changes to the `r glossary("repository")`, it must first be `r glossary("clone", display = "cloned")` to the `r glossary("local", display = "local computer")`. Copy the `r glossary("URL")` of the `r glossary("repository")` from your web browser, then click "*Clone*" in *`r glossary("Sourcetree")`*. On this page, you can paste in the `r glossary("repository")` `r glossary("URL")`, set a working directory to which to download the files, and enter a name for the project within *`r glossary("Sourcetree")`*.

Further repositories can be cloned by clicking the "*+*" button on the right-hand side of the tab header.

```{r, label = "clone", dpi=110, fig.align = "center", echo = FALSE, fig.cap = "Clone options in Sourcetree"}
knitr::include_graphics("images/sourcetree/sourcetree_clone.png")
```

After clicking the "*Clone*" button, *`r glossary("Sourcetree")`* will open the project in the current tab.

```{r, label = "cloned", dpi=110, fig.align = "center", echo = FALSE, fig.cap = "Cloned repository in Sourcetree"}
knitr::include_graphics("images/sourcetree/sourcetree_cloned.png")
```

### Possible Directory Error

If you are using a university laptop, depending on where you `r glossary("clone")` the `r glossary("repository")` within your computer, you may get the following error pop up (figure \@ref(fig:directory-error)). If this happens, you'll need to do as they suggest. Open *`r glossary("Git Bash")`* by searching for it in the windows search bar, and type in the text suggested by the error message, then simply hit the enter key on your keyboard. 

```{r, label = "directory-error", dpi=110, fig.align = "center", echo = FALSE, fig.cap = "Error pop-up regarding permissions with the chosen directory"}
knitr::include_graphics("images/sourcetree/sourcetree_source_error.png")
```

# Preventing File Being Committed {#git-ignore}

When the `r glossary("remote")` `r glossary("repository")` was created, a file titled *.gitignore* was created. This file is what *`r glossary("Git")`* uses to know which files do not need version control. It is not necessary, but will mean that the *`r glossary("Sourcetree")`* won't get clogged up with files that don't need version control. This file can be edited in a text editor, like any other file. This may include files that are automatically generated or managed by other software. A good example of this is the editor configuration within the application used to write code; that is data related only to the `r glossary("local")` setup of the project, and is not needed for someone else to run the code on their own computer. You should also add files that contain sensitive information, such as datasets, passwords or `r glossary("API")` `r glossary("key", display = "keys")`.

Each line in this file names a file, folder or file type to be ignored when `r glossary("commit", display = "committing")`. All files of a given type can be excluded by using a `*` as a wildcard, eg. `*.xlsx` will ignore all excel spreadsheets.

# Committing and Pushing

In *`r glossary("Git")`* terminology, changes are "`r glossary("commit", display = "committed")`" to the `r glossary("local")` `r glossary("repository")`, then "`r glossary("push", display = "pushed")`" to the `r glossary("remote")` `r glossary("repository")` (in this case on *`r glossary("GitHub")`*). By `r glossary("commit", display = "committing")`, the changes are saved into the `r glossary("history", display = "version history")`, but remain only on the computer on which they were made. By `r glossary("push", display = "pushing")`, the changes are uploaded to the *`r glossary("GitHub")`*.

## Commit Changes {#commit}

To test that the project has been successfully set up and linked with the *`r glossary("GitHub")`* `r glossary("repository")`, we are now going to `r glossary("commit")` changes and check that *`r glossary("GitHub")`* also receives it.

Open the `README.md` file in any text editor, and add some new text. Next, create a new file in the project directory. In this example a file named `ImportantScript.py` was created. These changes will be automatically detected by *`r glossary("Sourcetree")`* as shown in \@ref(fig:diff-files).

```{r, label = "diff-files", dpi = 50, fig.align = "center", echo = FALSE, fig.cap = "Sourcetree having detected changes"}
knitr::include_graphics("images/sourcetree/sourcetree_files.png")
```

Note that you may see different coloured symbols next to each file. An orange square with a pencil indicates that this is an existing file that has been edited. A purple square with a question mark indicates that this file is new since the `r glossary("commit")`.

Clicking on a changed file will show a `r glossary("diff")` (Short for "difference") in the right-hand panel, as in \@ref(fig:diff-change).

```{r, label = "diff-change", dpi = 50, fig.align = "center", echo = FALSE, fig.cap = "Sourcetree showing the 'diff' for an updated file"}
knitr::include_graphics("images/sourcetree/sourcetree_diff_change.png")
```

Before `r glossary("commit", display = "committing")` these changes, they must first be "`r glossary("stage", display = "staged")`". This means marking the files as ready to be `r glossary("commit", display = "committed")`. Files can be `r glossary("stage")` individually by selected the grey plus button to the right of each file, or all at once, using the "*Stage All*" button.

Once all the files are `r glossary("stage", display = "staged")`, a `r glossary("commit")` message should be added to the text box at the bottom of the page, then the "*Commit*" button can be clicked. Often the option to "Push changes automatically to origin/main" will be selected, but at this moment, the file is only `r glossary("commit", display = "committed")`.

Again, note the different symbols next to the files. The green square with a plus symbol indicates that the file is a new file, rather than an edit to an existing file in the `r glossary("repository")`..

```{r, label = "staged", dpi = 50, fig.align = "center", echo = FALSE, fig.cap = "Sourcetree showing the files staged"}
knitr::include_graphics("images/sourcetree/sourcetree_staged.png")
```

Once the changes have been `r glossary("commit", display = "committed")`, *`r glossary("Sourcetree")`* will display the "*History*" page, showing all `r glossary("commit", display = "commits")` to the project.

```{r, label = "committed", dpi = 50, fig.align = "center", echo = FALSE, fig.cap = "Sourcetree showing the commit history"}
knitr::include_graphics("images/sourcetree/sourcetree_committed.png")
```

Checking the project on *`r glossary("GitHub")`* will show that the changes have not yet been uploaded. This will be done in the next step, by "`r glossary("push", display = "pushing")`" to the `r glossary("remote")` `r glossary("repository")`.

## Push Changes to *GitHub* {#push}

### Start Push

Note that in the top-left of the *`r glossary("Sourcetree")`* window, the "*Push*" button has a `1` badge on it. This is showing that there is 1 `r glossary("local")` `r glossary("commit")` which has not yet been `r glossary("push", display = "pushed")` to the `r glossary("remote")` `r glossary("repository")`. Clicking that button will open a popup to configure that "`r glossary("push")`" \@ref(fig:push).

```{r, label = "push", dpi = 50, fig.align = "center", echo = FALSE, fig.cap = "'push' popup in Sourcetree"}
knitr::include_graphics("images/sourcetree/sourcetree_push.png")
```

Click the "*Push*" button, and the `r glossary("commit", display = "commits")` will be `r glossary("push", display = "pushed")` to *`r glossary("GitHub")`*.

### Provide Credentials

When you `r glossary("push")` for the first time, you will need to provide *`r glossary("GitHub")`* credentials to prove that you have permission to `r glossary("push")` to the `r glossary("remote")` `r glossary("repository")`. When you `r glossary("push")` subsequent times, the credentials should be stored, so you don't need to enter them again.

#### Windows Credentials Issue

On Windows computers, it is possible that the first `r glossary("push")` will fail due to the credentials being invalid, as in \@ref(fig:failed-push). This is due to Windows Credentials Manager using the wrong credentials to connect to *`r glossary("GitHub")`*.

```{r, label = "failed-push", dpi = 50, fig.align = "center", echo = FALSE, fig.cap = "Sourcetree showing the GitHub sign in popup"}
knitr::include_graphics("images/sourcetree/sourcetree_failed_push.png")
```

To fix this, the credentials should be cleared. Open the Windows Credentials Manager by searching for "credentials" in the task bar, then click "*Manage Windows Credentials*" to open the manager.

```{r, label = "windows-credentials-search", dpi = 50, fig.align = "center", echo = FALSE, fig.cap = "Search credentials manager in the windows task bar"}
knitr::include_graphics("images/windows_credentials_search.png")
```

Then remove any credentials which mention "git", as shown in \@ref(fig:windows-credentials-remove).

```{r, label = "windows-credentials-remove", dpi = 50, fig.align = "center", echo = FALSE, fig.cap = "Remove credentials from Windows Credentials Manager"}
knitr::include_graphics("images/windows_credentials_remove.png")
```

Once this has been done, retry the `r glossary("push")`.

### Provide GitHub Credentials

You will most likely be faced with a popup as seen in figure \@ref(fig:credentials) to link your *`r glossary("GitHub")`* account. Choose "*Sign in with your browser*" and then simply sign in (if you're already signed in on your web browser you may not need to do anything).

```{r, label = "credentials", dpi = 50, fig.align = "center", echo = FALSE, fig.cap = "Sourcetree showing the GitHub sign in popup"}
knitr::include_graphics("images/sourcetree/sourcetree_github_signin.png")
```

### Completed Push

After signing in, the `r glossary("push")` will complete and *`r glossary("Sourcetree")`* will return to the "*History*" tab.

```{r, label = "pushed", dpi = 50, fig.align = "center", echo = FALSE, fig.cap = "Sourcetree showing the history tab after pushing"}
knitr::include_graphics("images/sourcetree/sourcetree_pushed.png")
```

Checking the `r glossary("repository")` on *`r glossary("GitHub")`* will now show that the changes have been received by *`r glossary("GitHub")`*. The page will need to be refreshed if it was left open from the original setup.

```{r, label = "pushed-github", dpi = 50, fig.align = "center", echo = FALSE, fig.cap = "GitHub showing changes after pushing"}
knitr::include_graphics("images/github/github_pushed.png")
```

## Reverting Changes

If changes have been made `r glossary("local", display = "locally")` and are deemed to be unnecessary, then they can be '`r glossary("revert", display = "reverted")`' back to the state of the most recent `r glossary("commit")`.

On the "*Commit*" page in *`r glossary("Sourcetree")`*, right-click on the file to be `r glossary("revert", display = "reverted")`, and click "*Revert*", or "*Discard File Changes*". This will discard all changes to that file since the most recent `r glossary("commit")`.

```{r, label = "revert", dpi = 50, fig.align = "center", echo = FALSE, fig.cap = "Menu item to revert changes in Sourcetree"}
knitr::include_graphics("images/sourcetree/sourcetree_revert.png")
```

# Fetching and Pulling: Collaborating with Others

If all the changes come from a single computer, then `r glossary("commit", display = "committing")` and `r glossary("push", display = "pushing")` are the only operations that are needed. However, more often than not, changes will be `r glossary("commit", display = "committed")` from multiple users on computers. In these cases, the `r glossary("local")` `r glossary("repository")` on each computer needs to be synchronised with the `r glossary("remote")` `r glossary("repository")`, downloading changes made by others, and `r glossary("merge", display = "merging")` them into the `r glossary("local", display = "local changes")`.

This section will demonstrate how to keep a `r glossary("local")` `r glossary("repository")` in synch with the `r glossary("remote")` `r glossary("repository")` on *`r glossary("GitHub")`*.

## Commit Change via *GitHub* Directly {#remote-commit}

Instead of `r glossary("commit", display = "committing")` changes from another computer, changes can be `r glossary("commit", display = "committed")` directly on *`r glossary("GitHub")`*. Go to the home page of the `r glossary("repository")` and click the pencil button in the top-right of the README panel, as shown in \@ref(fig:github-edit).

```{r, label = "github-edit-button", dpi = 50, fig.align = "center", echo = FALSE, fig.cap = "Edit button for README.md on GitHub"}
knitr::include_graphics("images/github/github_edit_button.png")
```

Make some changes, then click the "*Commit Changes*" button.

```{r, label = "github-edit", dpi = 50, fig.align = "center", echo = FALSE, fig.cap = "Edit page onGitHub"}
knitr::include_graphics("images/github/github_edit.png")
```

Then click the "*Commit Changes*" button on the popup shown in \@ref(fig:github-commit).

```{r, label = "github-commit", dpi = 50, fig.align = "center", echo = FALSE, fig.cap = "Commit popup on GitHub"}
knitr::include_graphics("images/github/github_commit.png")
```

## Fetch Changes

When bringing in changes from the `r glossary("remote")` `r glossary("repository")`, "`r glossary("fetch", display = "fetching")`" changes allows the incoming changes to be viewed without applying them to the `r glossary("local")` `r glossary("repository")`. It is not essential, but can be useful.

Back in *`r glossary("Sourcetree")`*, press the "*Fetch*" button to see the incoming changes from *`r glossary("GitHub")`*. Leave the default options on the popup, and click "*OK*".

```{r, label = "fetch", dpi = 50, fig.align = "center", echo = FALSE, fig.cap = "Fetch popup in Sourcetree"}
knitr::include_graphics("images/sourcetree/sourcetree_fetch.png")
```

*`r glossary("Sourcetree")`* will show the "*History*" tab, selecting and emboldening the `r glossary("commit")` on which the `r glossary("local", display = "local changes")` are based, as in \@ref(fig:fetched).

```{r, label = "fetched", dpi = 50, fig.align = "center", echo = FALSE, fig.cap = "Changes fetched, but not integrated into the local repository, shown by the latest changes being higher than the current repository version in the history panel"}
knitr::include_graphics("images/sourcetree/sourcetree_fetched.png")
```

## Pull Changes {#pull}

If the changes are to be `r glossary("merge", display = "merged")` into the `r glossary("local")` `r glossary("repository")`, then they can be "`r glossary("pull", display = "pulled")`". Click the "*Pull*" button. Again, the default options can be left as they are as in \@ref(fig:pull).

```{r, label = "pull", dpi = 50, fig.align = "center", echo = FALSE, fig.cap = "Pull popup in Sourcetree"}
knitr::include_graphics("images/sourcetree/sourcetree_pull.png")
```

Click "*Pull*" to bring in the changes. *`r glossary("Sourcetree")`* will show the updated "*History*" page, and the `r glossary("local", display = "local files")` will now include the changes made on *`r glossary("GitHub")`*.

```{r, label = "pulled", dpi = 50, fig.align = "center", echo = FALSE, fig.cap = "Sourcetree showing the history tab after pulling"}
knitr::include_graphics("images/sourcetree/sourcetree_pulled.png")
```

# Merging Conflicts

In this section, changes will be made to both the `r glossary("local")` and `r glossary("remote")` repositories, and the resulting `r glossary("conflict")` will be resolved.

## Make Changes Locally and on *GitHub*

Similarly to \@ref(commit), open the `README.md` file in any text editor, and add a new line. Similarly to \@ref(remote-commit), add a different new line to `README.md` and `r glossary("commit")` it directly on *`r glossary("GitHub")`*.

## Pull Changes from *GitHub*

### Uncommitted Changes

`r glossary("pull", display = "Pulling")` changes to a file which has `r glossary("commit", display = "uncommitted")` `r glossary("local", display = "local changes")` will result in an error, as shown in \@ref(fig:uncommitted-pull). The changes must be `r glossary("commit", display = "committed")` before the `r glossary("pull")` can be completed.

```{r, label = "uncommitted-pull", dpi = 50, fig.align = "center", echo = FALSE, fig.cap = "Sourcetree showing a failed pull due to uncommitted local changes conflicting with the remote changes"}
knitr::include_graphics("images/sourcetree/sourcetree_uncommitted_conflict.png")
```

### Committed Conflicting Changes

The `r glossary("local", display = "local changes")` can either be `r glossary("commit", display = "committed")` or `r glossary("revert", display = "reverted")`. For this example, `r glossary("commit")` the changes as shown in section \@ref(commit).

## Merge Changes

### Pull

Clicking the "*Pull*" button again will show that there are `r glossary("conflict", display = "conflicts")` to be resolved. Click "*Close*", and open the `r glossary("conflict", display = "conflicting")` file in your preferred editor. The `r glossary("conflict", display = "conflicting")` sections will be formatted as shown in \@ref(fig:resolve-conflict).

```{r, label = "resolve-conflict", dpi = 50, fig.align = "center", echo = FALSE, fig.cap = "Sourcetree showing conflicts in the bottom-right panel"}
knitr::include_graphics("images/sourcetree/sourcetree_resolve_conflict.png")
```

### Resolve Conflicts

If the changes are to be fully overwritten by either the `r glossary("remote")` or the `r glossary("local", display = "local file")`, then the right-click menu, shown in \@ref(fig:resolve-conflicts-menu), can be used to "*Resolve Using 'Mine'*" to overwrite with `r glossary("local", display = "local changes")`, or "*Resolve Using 'Theirs'*" to overwrite with `r glossary("remote")` changes.

If the `r glossary("conflict", display = "conflicts")` are more complex, then the `r glossary("conflict", display = "conflicting")` file will need to be edited and `r glossary("merge", display = "merged")` manually. Make the necessary changes to the file, making sure to remove the characters that were added to indicate `r glossary("merge")` `r glossary("conflict", display = "conflicts")` (i.e. '====' and '<<< HEAD'). Once complete, use the right-click menu and select "*Mark Resolved*", which will automatically `r glossary("stage")` the changes.

```{r, label = "resolve-conflicts-menu", dpi = 50, fig.align = "center", echo = FALSE, fig.cap = "Menu item to manually resolve conflicts in Sourcetree"}
knitr::include_graphics("images/sourcetree/sourcetree_resolve_conflict_menu.png")
```

### Stage, Commit and Push

Once the `r glossary("conflict", display = "conflicts")` have been resolved, then they can be `r glossary("commit", display = "committed")` and `r glossary("push", display = "pushed")` as normal. A `r glossary("commit")` comment will be automatically generated for this `r glossary("merge")` `r glossary("commit")`, as shown in \@ref(fig:resolved-conflict-commit).

```{r, label = "resolved-conflict-commit", dpi = 50, fig.align = "center", echo = FALSE, fig.cap = "Sourcetree with automatically generated commit message for merge"}
knitr::include_graphics("images/sourcetree/sourcetree_resolved_conflict_commit.png")
```

The "*History*" page will be shown again with the changes `r glossary("merge", display = "merged")` in, as if \@ref(fig:resolved-conflict-pushed).

```{r, label = "resolved-conflict-pushed", dpi = 50, fig.align = "center", echo = FALSE, fig.cap = "Sourcetree showing the history tab after pushing"}
knitr::include_graphics("images/sourcetree/sourcetree_resolved_conflict_pushed.png")
```

# Branches

Whilst often not necessary when working individually on a project, "`r glossary("branch", display = "branches")`" are a useful feature of *`r glossary("Git")`*, allowing the user to make changes whilst keeping a safe copy of the original code still available. It is also useful when multiple people are working on different features in the same `r glossary("codebase")` - each user can be working on a separate `r glossary("branch")`, avoiding `r glossary("conflict", display = "conflicts")` until the changes are `r glossary("merge", display = "merged")` back into the main `r glossary("branch")`.

## Create a Branch

`r glossary("branch", display = "Branches")` can be created on the `r glossary("remote")` `r glossary("repository")` directly using *`r glossary("GitHub")`*, or on the `r glossary("local")` `r glossary("repository")` using *`r glossary("Sourcetree")`*, then `r glossary("push", display = "pushed")` to *`r glossary("GitHub")`*. Both of these approaches are described here. Either method is acceptable, so feel free to use whichever workflow is preferred.

### Using *GitHub*

#### Create Branch

Go to the project home and click on the `r glossary("branch", display = "branches")` button, titled "*1 branch*", in the top-left.

```{r, label = "github-branch", dpi = 50, fig.align = "center", echo = FALSE, fig.cap = "Branches button on GitHub"}
knitr::include_graphics("images/github/github_branch_button.png")
```

*`r glossary("GitHub")`* will display all of the current `r glossary("branch", display = "branches")` in the `r glossary("repository")`; currently there is only one `r glossary("branch")`, "main".

```{r, label = "github-branches", dpi = 50, fig.align = "center", echo = FALSE, fig.cap = "Branches page on GitHub"}
knitr::include_graphics("images/github/github_branches.png")
```

Click the "*New Branch*" button, in the top-right, and enter a `r glossary("branch")` name. `r glossary("branch", display = "Branches")` must have unique names to identify them. *`r glossary("GitHub")`* allows for `r glossary("branch", display = "branches")` to be created from any other `r glossary("branch")`, but in this case there is only "main". Click "*Create new branch*".

```{r, label = "github-new-branch", dpi = 50, fig.align = "center", echo = FALSE, fig.cap = "Create branch popup on GitHub"}
knitr::include_graphics("images/github/github_new_branch.png")
```

*`r glossary("GitHub")`* will return to the `r glossary("branch", display = "branches")` page, but the new `r glossary("branch")` is now present. This can now be `r glossary("checkout", display = "checked out")` in *`r glossary("Sourcetree")`*.

```{r, label = "github-new-branches", dpi = 50, fig.align = "center", echo = FALSE, fig.cap = "Branches page on GitHub after new branch has been created"}
knitr::include_graphics("images/github/github_new_branches.png")
```

#### Checkout branch {#checkout}

To access this `r glossary("branch")` in *`r glossary("Sourcetree")`*, it must be `r glossary("checkout", display = "checked out")`. In order for *`r glossary("Sourcetree")`* to detect the newly created `r glossary("remote")` `r glossary("branch")`, changes must first be `r glossary("pull", display = "pulled")`. Once that has completed, find the `r glossary("branch")` by expanding the "*Remotes*" section in the left-hand panel, and select it. Right click on the selected `r glossary("branch")` and click "Checkout origin/<BRANCH NAME>".

```{r, label = "checkout-branch", dpi = 50, fig.align = "center", echo = FALSE, fig.cap = "Menu item to checkout a remote branch within Sourcetree"}
knitr::include_graphics("images/sourcetree/sourcetree_checkout_branch.png")
```

Leave the default options in the popup, and click "*OK*". Once it has finished processing, the working copy is now on the `r glossary("branch")`.

```{r, label = "checkout-new-branch", dpi = 50, fig.align = "center", echo = FALSE, fig.cap = "Remote branch checkout popup in Sourcetree"}
knitr::include_graphics("images/sourcetree/sourcetree_checkout_new_branch.png")
```

### Using *Sourcetree*

Before a `r glossary("branch")` is to be created, the base for the new `r glossary("branch")` must be `r glossary("checkout", display = "checked out")`. This is described in \@ref(checkout). A `r glossary("branch")` on the `r glossary("local")` `r glossary("repository")` can also be used as a base, by checking out the `r glossary("local")` `r glossary("branch")` within the "*Branches*" section in the left-hand panel. You can see which `r glossary("branch")` has been `r glossary("checkout", display = "checked out")` by seeing it emboldened.

In *`r glossary("Sourcetree")`*, click the "*Branch*" button in the top bar, and enter the name of the new `r glossary("branch")`. Click "*Create Branch*", and it will be created and `r glossary("checkout", display = "checked out")`.

```{r, label = "sourcetree-create-branch", dpi = 50, fig.align = "center", echo = FALSE, fig.cap = "New branch popup in Sourcetree"}
knitr::include_graphics("images/sourcetree/sourcetree_create_branch.png")
```

To add the new `r glossary("branch")` to the `r glossary("remote")` `r glossary("repository")` on *`r glossary("GitHub")`*, changes must be `r glossary("push", display = "pushed")`. Click the "*Push*" button in the top bar, then select only the new `r glossary("branch")` to be `r glossary("push", display = "pushed")`. The "*Track?*" checkboxes can be left as the defaults. Click "*Push*" to add the new `r glossary("branch")` to the `r glossary("remote")` `r glossary("repository")`.

For any future `r glossary("commit", display = "commits")` on a `r glossary("branch")`, it is only necessary to `r glossary("push")` the current working `r glossary("branch")`

```{r, label = "push-branch", dpi = 50, fig.align = "center", echo = FALSE, fig.cap = "Push popup in Sourcetree"}
knitr::include_graphics("images/sourcetree/sourcetree_push_new_branch.png")
```

## Merging Branches

After changes are completed on a `r glossary("branch")`, they should be `r glossary("merge", display = "merged")` back to the main `r glossary("branch")`. The simplest way to do this is via *`r glossary("GitHub")`*, but it can also be done via *`r glossary("Sourcetree")`*. If a project does not have a `r glossary("remote")` `r glossary("repository")`, then `r glossary("merge", display = "merging")` can only be done via *`r glossary("Sourcetree")`*.

First, make a change, `r glossary("commit")` it to the new `r glossary("branch")` and `r glossary("push")` the `r glossary("commit")`. In this case, "aims" have been added to the README file.

```{r, label = "add-aims", dpi = 50, fig.align = "center", echo = FALSE, fig.cap = "Sourcetree showing local changes in commit page"}
knitr::include_graphics("images/sourcetree/sourcetree_add_aims.png")
```

### Merging in *GitHub*

#### Create Pull Request

Go to the `r glossary("repository")` in *`r glossary("GitHub")`*, and select the `r glossary("branch")` in the drop-down box in the top-left. You may see that the `r glossary("branch")` is ahead of the main `r glossary("branch")`, or that changes were recently `r glossary("push", display = "pushed")` to the `r glossary("branch")`. To `r glossary("merge")` the `r glossary("branch", display = "branches")`, click on the green "*Compare and pull request*" button.

```{r, label = "recent-push", dpi = 50, fig.align = "center", echo = FALSE, fig.cap = "GitHub showing recent changes to branch"}
knitr::include_graphics("images/github/github_recent_push.png")
```

If the `r glossary("branch")` is older and hasn't had recent `r glossary("push", display = "pushes")`, then a new `r glossary("pull request")` can be opened by clicking on "*Pull requests*" at the top of the page.

```{r, label = "pull-requests", dpi = 50, fig.align = "center", echo = FALSE, fig.cap = "Pull requests page on GitHub"}
knitr::include_graphics("images/github/github_pull_requests.png")
```

Click "*New pull request*" to open the configuration page, then select the `r glossary("branch")` to `r glossary("merge")` into main.

```{r, label = "new-pull-request", dpi = 50, fig.align = "center", echo = FALSE, fig.cap = "Comparing changes page on GitHub"}
knitr::include_graphics("images/github/github_selected_pull_request.png")
```

Add a title and a description, then click "*Create pull request*".

```{r, label = "create-pull-request", dpi = 50, fig.align = "center", echo = FALSE, fig.cap = "Create pull request page on GitHub"}
knitr::include_graphics("images/github/github_create_pull_request.png")
```

#### Merge Pull Request

Within the created `r glossary("pull request")`, the changes can be reviewed. When happy with the changes, click "*Merge pull request*". If changes cannot be automatically `r glossary("merge", display = "merged")`, then *`r glossary("GitHub")`* will ask you to resolve `r glossary("conflict", display = "conflicts")` before `r glossary("merge", display = "merging")`.

```{r, label = "created-pull-request", dpi = 50, fig.align = "center", echo = FALSE, fig.cap = "Created pull request page on GitHub"}
knitr::include_graphics("images/github/github_created_pull_request.png")
```

The default `r glossary("commit")` message can be left unchanged unless required, then click "*Confirm merge*".

```{r, label = "confirm-merge", dpi = 50, fig.align = "center", echo = FALSE, fig.cap = "Merge options on GitHub"}
knitr::include_graphics("images/github/github_confirm_merge.png")
```

Click "*Delete branch*" to delete the `r glossary("branch")` from the `r glossary("remote")` `r glossary("repository")`.

```{r, label = "delete-remote-branch-github", dpi = 50, fig.align = "center", echo = FALSE, fig.cap = "Merge confirmation on GitHub"}
knitr::include_graphics("images/github/github_delete_branch.png")
```

Returning to the home page of the project will show that the changes are now present on main and that there is only one `r glossary("branch")` on the project.

```{r, label = "github-merged", dpi = 50, fig.align = "center", echo = FALSE, fig.cap = "Repository home page on GitHub showing one branch and including changes from merged branch"}
knitr::include_graphics("images/github/github_merged.png")
```

#### Checkout Main Branch in *Sourcetree* {#post-merge-checkout}

Back in *`r glossary("Sourcetree")`*, the main `r glossary("branch")` needs to be `r glossary("checkout", display = "checked out")`, as the `r glossary("local")` `r glossary("branch")` no longer points to a `r glossary("remote")` `r glossary("branch")`. Select the "main" `r glossary("branch")` in the "*Branches*" section in the left-hand panel, then right-click and click "Checkout main...".

```{r, label = "post-merge-checkout", dpi = 50, fig.align = "center", echo = FALSE, fig.cap = "Menu item to checkout the main branch in Sourcetree"}
knitr::include_graphics("images/sourcetree/sourcetree_checkout_main.png")
```

Once the `r glossary("checkout")` has completed, `r glossary("pull")` from the `r glossary("remote")` `r glossary("repository")` to get the `r glossary("merge", display = "merged")` changes. You can also delete the removed `r glossary("branch", display = "branches")` from *`r glossary("Sourcetree")`* as in section \@ref(delete-sourcetree-branches).

### Merging in *Sourcetree*

#### Merge Changes

In *`r glossary("Sourcetree")`*, `r glossary("checkout")` the main `r glossary("branch")`, as in \@ref(post-merge-checkout), then click "*Merge*" in the top bar. Select the most recent `r glossary("commit")` from the `r glossary("branch")`, then click "*OK*". The `r glossary("merge")` will be completed and the `r glossary("local")` main `r glossary("branch")` will include the changes from the `r glossary("branch")`.

```{r, label = "select-merge-commit", dpi = 50, fig.align = "center", echo = FALSE, fig.cap = "Merge popup in Sourcetree"}
knitr::include_graphics("images/sourcetree/sourcetree_select_merge_commit.png")
```

The main `r glossary("branch")` should then be `r glossary("push", display = "pushed")` to the `r glossary("remote")` `r glossary("repository")`.

#### Delete Branches {#delete-sourcetree-branches}

The `r glossary("branch")` can now be deleted both `r glossary("local", display = "locally")` and `r glossary("remote", display = "remotely")`. The `r glossary("local")` `r glossary("repository")` can be deleted in the same right-click menu used to `r glossary("checkout")` a `r glossary("local")` `r glossary("branch")`.

```{r, label = "delete-local-branch", dpi = 50, fig.align = "center", echo = FALSE, fig.cap = "Menu item to delete a local branch in sourcetree"}
knitr::include_graphics("images/sourcetree/sourcetree_delete_local_branch.png")
```

The `r glossary("remote")` `r glossary("repository")` can be deleted in the same right-click menu used to `r glossary("checkout")` a `r glossary("remote")` `r glossary("branch")`.

```{r, label = "delete-remote-branch", dpi = 50, fig.align = "center", echo = FALSE, fig.cap = "Menu item to delete a remote branch in sourcetree"}
knitr::include_graphics("images/sourcetree/sourcetree_delete_remote_branch.png")
```

# Other Resources
- [Happy Git and GitHub for the useR](https://happygitwithr.com/)
  - Getting started with Git and GitHub specifically for *R* users.

If you find yourself stuck with any of the topics covered in this document, please feel free to contact us at clareece.nevill@leicester.ac.uk or janion.nevill@leicester.ac.uk.

# Glossary
```{r, echo = FALSE, message = FALSE}
glossary::glossary_load_all("gitGlossary.yml")
glossary::glossary_table()
```
